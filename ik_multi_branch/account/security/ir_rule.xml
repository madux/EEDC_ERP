<?xml version="1.0" encoding="utf-8"?>
    <odoo noupdate="0">
        <function model="ir.model.data" name="write">
            <function model="ir.model.data" name="search">
                <value eval="[('module', '=', 'account'), ('name', '=', 'account_move_rule_group_readonly')]"/>
            </function>
            <value eval="{'noupdate': False}"/>
        </function>
        <function model="ir.model.data" name="write">
            <function model="ir.model.data" name="search">
                <value eval="[('module', '=', 'account'), ('name', '=', 'account_move_rule_group_invoice')]"/>
            </function>
            <value eval="{'noupdate': False}"/>
        </function>

        <function model="ir.model.data" name="write">
            <function model="ir.model.data" name="search">
                <value eval="[('module', '=', 'account'), ('name', '=', 'account_move_see_all')]"/>
            </function>
            <value eval="{'noupdate': False}"/>
        </function>

        
        <!-- <record id="branch_user_see_only_account_journal" model="ir.rule">
            <field name="name">branch: Internal users See only related branch journal</field>
            <field name="model_id" ref="account.model_account_journal"/>
            <field name="global" eval="True"/>
            
            <field name="domain_force">['|','|',
            ('for_public_use', '=', True), 
            ('branch_id.id', '=', user.branch_id.id),
            ('branch_id.id', 'in', user.branch_ids.ids)
            ]</field>
        </record> -->

        <record id="branch_user_see_only_account_payment" model="ir.rule">
            <field name="name">branch: Internal users See only related branch payments</field>
            <field name="model_id" ref="account.model_account_payment"/>
            <field name="global" eval="False"/>
            <field name="groups" eval="[
            (4, ref('account.group_account_readonly')),
            (4, ref('account.group_account_invoice')),
            ]"/>
            <field name="domain_force">['|',('branch_id.id', '=', user.branch_id.id),('branch_id.id', 'in', user.branch_ids.ids)]</field>
        </record>

        <record id="subco_see_holdco_payments_via_memo" model="ir.rule">
            <field name="name">SubCo: See HoldCo Payments for Own Memos</field>
            <field name="model_id" ref="account.model_account_payment"/>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
            <field name="domain_force">[
                '|',
                ('branch_id.id', '=', user.branch_id.id),
                '|',
                ('memo_reference.employee_id.user_id', '=', user.id),
                ('memo_reference.users_followers.user_id', '=', user.id)
            ]</field>
        </record>


        <record id="branch_user_see_only_account_batch_payment" model="ir.rule">
            <field name="name">branch: Internal users See only related branch batch payments</field>
            <field name="model_id" ref="account_batch_payment.model_account_batch_payment"/>
            <field name="global" eval="True"/>
            <field name="domain_force">[
            ('branch_id.id', '=', user.branch_id.id)]
            </field>
        </record>

        <record id="branch_admin_all_only_account_batch_payment" model="ir.rule">
            <field name="name">branch: Internal admin all only related branch batch payments</field>
            <field name="model_id" ref="account_batch_payment.model_account_batch_payment"/>
            <field name="global" eval="True"/>
            <field name="domain_force">[
            (1, '=', 1)]
            </field>
        </record>

        <!-- Allow memo initiators/followers to see payments in other companies -->
        <record id="memo_cross_company_account_payment_access" model="ir.rule">
            <field name="name">Memo: Cross-Company Payment Access</field>
            <field name="model_id" ref="account.model_account_payment"/>
            <field name="domain_force">[
                '|', '|', '|', '|',
                ('memo_reference.employee_id.user_id', '=', user.id),
                ('memo_reference.create_uid', '=', user.id),
                ('memo_reference.users_followers.user_id', '=', user.id),
                ('memo_reference.stage_id.approver_ids.user_id', '=', user.id),
                ('memo_reference.memo_setting_id.approver_ids.user_id', '=', user.id)
            ]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        </record>

        

        <record id="branch_user_see_all_acount_journal" model="ir.rule">
            <field name="name">branch: top account users See all journal</field>
            <field name="model_id" ref="account.model_account_journal"/>
            <field name="global" eval="True"/>
            <field name="groups" eval="[
            (4, ref('ik_multi_branch.account_major_user')),
            ]"/>
            <field name="domain_force">[(1,'=',1)]</field>
        </record>

        <record id="branch_user_see_all_acount_payment" model="ir.rule">
            <field name="name">branch: top account users See all payment</field>
            <field name="model_id" ref="account.model_account_payment"/>
            <field name="global" eval="True"/>
            <field name="groups" eval="[
            (4, ref('ik_multi_branch.account_major_user')),
            ]"/>
            <field name="domain_force">[(1,'=',1)]</field>
        </record>
        
        <record id="branch_user_see_only_aacount_moves" model="ir.rule">
            <field name="name">branch: Internal users See only related branch moves</field>
            <field name="model_id" ref="account.model_account_move"/>
            <field name="global" eval="False"/>
            <field name="groups" eval="[
            (4, ref('account.group_account_readonly')),
            (4, ref('account.group_account_invoice')),
            ]"/>
            <field name="domain_force">['|',
            ('branch_id.id', '=', user.branch_id.id),
            ('branch_id.id', 'in', user.branch_ids.ids)
            ]</field>
        </record>

        <record id="branch_user_see_all_acount_moves" model="ir.rule">
            <field name="name">branch: top account users See all moves</field>
            <field name="model_id" ref="account.model_account_move"/>
            <field name="global" eval="True"/>
            <field name="groups" eval="[
            (4, ref('ik_multi_branch.account_major_user')),
            ]"/>
            <field name="domain_force">[(1,'=',1)]</field>
        </record>

        <record id="account.account_move_see_all" model="ir.rule">
            <field name="name">Branch: All Journal Entry</field>
            <field ref="account.model_account_move" name="model_id"/>
            <field name="domain_force">['|',('branch_id.id', '=', user.branch_id.id),('branch_id.id', 'in', user.branch_ids.ids)]</field>
            <!-- <field name="groups" eval="[(4, ref('account.group_account_invoice'))]"/> -->
        </record>

        <record id="account.account_move_rule_group_readonly" model="ir.rule">
            <field name="name">Branch: Readonly Move Journal Entry 2</field>
            <field name="model_id" ref="account.model_account_move"/>
            <field name="domain_force">['|',('branch_id.id', '=', user.branch_id.id),('branch_id.id', 'in', user.branch_ids.ids)]</field>
            <!-- <field name="groups" eval="[(4, ref('account.group_account_readonly'))]"/> -->
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
            <field name="perm_read" eval="True"/>
        </record>

        <record id="account.account_move_rule_group_invoice" model="ir.rule">
            <field name="name">Branch: Readonly Move Journal Entry 3</field>
            <field name="model_id" ref="account.model_account_move"/>
            <field name="domain_force">['|',('branch_id.id', '=', user.branch_id.id),('branch_id.id', 'in', user.branch_ids.ids)]</field>
            <!-- <field name="groups" eval="[(4, ref('account.group_account_invoice'),(4, ref('account.group_account_readonly'))]"/> -->
        </record>

        <record id="subco_see_holdco_moves_via_memo" model="ir.rule">
            <field name="name">SubCo: See HoldCo Journal Entries for Own Memos</field>
            <field name="model_id" ref="account.model_account_move"/>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
            <field name="domain_force">[
                '|',
                ('branch_id.id', '=', user.branch_id.id),
                '|',
                ('memo_id.employee_id.user_id', '=', user.id),
                ('memo_id.users_followers.user_id', '=', user.id)
            ]</field>
        </record>

        <!-- Allow memo initiators/followers to see journal entries in other companies -->
        <record id="memo_cross_company_account_move_access" model="ir.rule">
            <field name="name">Memo: Cross-Company Journal Entry Access</field>
            <field name="model_id" ref="account.model_account_move"/>
            <field name="domain_force">[
                '|', '|', '|', '|',
                ('memo_id.employee_id.user_id', '=', user.id),
                ('memo_id.create_uid', '=', user.id),
                ('memo_id.users_followers.user_id', '=', user.id),
                ('memo_id.stage_id.approver_ids.user_id', '=', user.id),
                ('memo_id.memo_setting_id.approver_ids.user_id', '=', user.id)
            ]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <!-- Allow cross-company product access for memo approvers -->
        <record id="product_cross_company_memo_access" model="ir.rule">
            <field name="name">Memo: Cross-Company Product Access</field>
            <field name="model_id" ref="product.model_product_product"/>
            <field name="global" eval="False"/>
            <field name="domain_force">[
                '|', '|', '|',
                ('company_id', '=', user.company_id.id),
                ('company_id', 'in', user.company_ids.ids),
                ('id', 'in', [
                    line.product_id.id 
                    for memo in user.env['memo.model'].search([
                        '|', '|', '|',
                        ('stage_id.approver_ids.user_id', '=', user.id),
                        ('memo_setting_id.approver_ids.user_id', '=', user.id),
                        ('users_followers.user_id', '=', user.id),
                        ('employee_id.user_id', '=', user.id)
                    ])
                    for line in memo.product_ids
                ])
            ]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        </record>

    </odoo>