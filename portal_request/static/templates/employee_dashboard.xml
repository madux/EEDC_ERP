<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <template id="portal_dashboard_template_id" name="Employee Dashboard">
      <t t-call="website.layout">
        <section id="portal-dashboard-form" class="s_website_form pt2 pb2" data-vcss="001">

          <!-- App Grid (unchanged, toggleable) -->
          <section id="website-app-section" class="page-section">
            <t t-call="portal_request.website_app_page"/>
          </section>

          <!-- Dashboard -->
          <div id="portal-dashboard-content" class="page-section active">
            <div class="container my-5 tm-admin-page" data-profile-init="1">

              <!-- Top toolbar -->
              <div class="tm-ad-toolbar d-flex align-items-center justify-content-between mb-4">
                <div class="d-flex align-items-center gap-3">
                  <div id="app-icon" class="thumbnail-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30"
                         class="bi bi-grid-fill custom-icon" viewBox="0 0 16 16">
                      <path d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5zm8 0A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5zm-8 8A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5zm8 0A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5z"/>
                    </svg>
                  </div>
                  <div>
                    <h4 class="mb-0">My Profile</h4>
                    <small class="text-muted">Overview • Activity • Performance</small>
                  </div>
                </div>

                <div class="d-flex gap-2">
					<button id="pf_refresh" class="btn btn-primary">Refresh</button>
					<a href="/taskboard"><button id="nav_to_taskboard" class="btn btn-secondary">Taskboard</button></a>
                </div>
              </div>

			  <!-- KPI tiles -->
				<div class="row g-3 mb-4 tm-ad-kpis">
				<!-- Open -->
				<div class="col-6 col-md-3">
					<div class="tm-kpi -total">
					<span class="tm-kpi-icon" aria-hidden="true">
						<!-- Inbox -->
						<svg viewBox="0 0 24 24">
						<path d="M3 8l4-4h10l4 4v8a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V8z" fill="none" stroke="currentColor" stroke-width="2"/>
						<path d="M3 13h5a4 4 0 0 0 8 0h5" fill="none" stroke="currentColor" stroke-width="2"/>
						</svg>
					</span>
					<div class="tm-kpi-label">Open Requests</div>
					<div id="open_request" class="tm-kpi-value"><t t-esc="open_request"/></div>
					</div>
				</div>

				<!-- Approvals -->
				<div class="col-6 col-md-3">
					<div class="tm-kpi -today">
					<span class="tm-kpi-icon" aria-hidden="true">
						<!-- Clipboard check -->
						<svg viewBox="0 0 24 24">
						<rect x="7" y="4" width="10" height="14" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
						<path d="M9 7h6" fill="none" stroke="currentColor" stroke-width="2"/>
						<path d="M9 12l2 2 4-4" fill="none" stroke="currentColor" stroke-width="2"/>
						</svg>
					</span>
					<div class="tm-kpi-label">Approval Requests</div>
					<div id="approved_request" class="tm-kpi-value"><t t-esc="approved_request"/></div>
					</div>
				</div>

				<!-- Closed -->
				<div class="col-6 col-md-3">
					<div class="tm-kpi -done">
					<span class="tm-kpi-icon" aria-hidden="true">
						<!-- Check circle -->
						<svg viewBox="0 0 24 24">
						<circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
						<path d="M8.5 12.5l2.5 2.5 4.5-5" fill="none" stroke="currentColor" stroke-width="2"/>
						</svg>
					</span>
					<div class="tm-kpi-label">Closed Requests</div>
					<div id="closed_request" class="tm-kpi-value"><t t-esc="closed_request"/></div>
					</div>
				</div>

				<!-- Leave -->
				<div class="col-6 col-md-3">
					<div class="tm-kpi -blocked">
					<span class="tm-kpi-icon" aria-hidden="true">
						<!-- Calendar -->
						<svg viewBox="0 0 24 24">
						<rect x="3" y="4" width="18" height="17" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
						<path d="M16 2v4M8 2v4M3 10h18" fill="none" stroke="currentColor" stroke-width="2"/>
						</svg>
					</span>
					<div class="tm-kpi-label">Leave Remaining</div>
					<div id="leave_remaining" class="tm-kpi-value"><t t-esc="leave_remaining"/></div>
					</div>
				</div>
				</div>


              <!-- Content grid -->
              <div class="row g-3">
                <!-- Left: profile card + performance -->
                <div class="col-lg-8 d-flex flex-column gap-3">

					<!-- Profile -->
					<div class="tm-card pf-card">
					<div class="tm-card-head d-flex align-items-center justify-content-between">
						<span>Employee Profile</span>
					</div>

					<div class="tm-card-body">
						<div class="pf-wrap d-flex align-items-center gap-3">
						<!-- Avatar with gradient ring (falls back to initials if no image) -->
						<div class="pf-avatar">
							<t t-if="image_url">
								<img t-att-src="image_url" alt="Avatar"/>
							</t>
							<t t-elif="image">
								<img t-att-src="image_data_uri(image)" alt="Avatar"/>
							</t>
							<t t-else="">
							<div class="pf-initials">
								<t t-esc="(user.employee_id.name or user.name or '?')[0]"/>
							</div>
							</t>
						</div>

						<div class="flex-grow-1">
							<!-- Top row: name + status + date + queries chip -->
							<div class="d-flex flex-wrap align-items-center gap-2">
							<h5 class="mb-0 me-2" id="pf_name"><t t-esc="user.employee_id.name"/></h5>

							<span class="pf-badge -active">
								<span class="pf-dot"></span> Active
							</span>

							<span class="pf-date text-muted">
								as at <t t-esc="datetime.datetime.now().strftime('%b %d, %Y')"/>
							</span>

							<span class="pf-badge -warn ms-md-auto">
								<i class="fa fa-flag me-1"></i> Queries: 0
							</span>
							</div>

							<!-- Details grid -->
							<div class="pf-grid mt-2">
							<div class="pf-row">
								<span class="pf-key">
								<svg viewBox="0 0 24 24"><path d="M3 21h18M6 21V3h12v18M9 8h2m2 0h2M9 12h2m2 0h2M9 16h2m2 0h2" fill="none" stroke="currentColor" stroke-width="2"/></svg>
								Department:
								</span>
								<span class="pf-val" id="pf_department">
								<t t-esc="user.employee_id.department_id.name or '—'"/>
								</span>
							</div>

							<div class="pf-row">
								<span class="pf-key">
								<svg viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="14" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="9" cy="12" r="2"/><path d="M13 10h5m-5 4h5" fill="none" stroke="currentColor" stroke-width="2"/></svg>
								Role:
								</span>
								<span class="pf-val" id="pf_role">
								<t t-esc="user.employee_id.job_id.name or '—'"/>
								</span>
							</div>

							<!-- Span full width for long manager names -->
							</div>
							<div class="pf-row -span2">
								<span class="pf-key">
								<svg viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H7a4 4 0 0 0-4 4v2" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="9" cy="7" r="3" fill="none" stroke="currentColor" stroke-width="2"/></svg>
								Manager:
								</span>
								<span class="pf-val" id="pf_manager">
								<t t-esc="user.employee_id.parent_id.name or '—'"/>
								</span>
							</div>
						</div>
						</div>
					</div>
					</div>
                  <!-- Performance (bars) -->
                  <div class="tm-card">
                    <div class="tm-card-head d-flex align-items-center justify-content-between">
                      <span>Performance Measure</span>
                      <div class="tm-card-tools">
                        <button class="tm-ct" data-type="bar" title="Bar"><svg viewBox="0 0 24 24"><rect x="3" y="10" width="4" height="11"/><rect x="10" y="6" width="4" height="15"/><rect x="17" y="2" width="4" height="19"/></svg></button>
                        <button class="tm-ct" data-type="line" title="Line"><svg viewBox="0 0 24 24"><path d="M3 18l6-7 4 3 8-9" fill="none" stroke="currentColor" stroke-width="2"/></svg></button>
                        <button class="tm-ct" data-action="expand" title="Expand"><svg viewBox="0 0 24 24"><path d="M3 10V3h7M21 14v7h-7M21 10V3h-7M3 14v7h7" fill="none" stroke="currentColor" stroke-width="2"/></svg></button>
                      </div>
                    </div>
                    <div class="tm-card-body">
                      <!-- Reuse admin chart key 'empDone' for a generic bar series -->
                      <canvas id="tm_ad_chart_emp_done"></canvas>
                    </div>
                  </div>

                </div>

                <!-- Right: donut + progress list -->
                <div class="col-lg-4 d-flex flex-column gap-3">

                  <div class="tm-card">
                    <div class="tm-card-head d-flex align-items-center justify-content-between">
                      <span>Workload Distribution</span>
                      <div class="tm-card-tools">
                        <button class="tm-ct" data-type="doughnut" title="Doughnut"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="12" r="4"/></svg></button>
                        <button class="tm-ct" data-type="pie" title="Pie"><svg viewBox="0 0 24 24"><path d="M12 12V3a9 9 0 019 9z"/><path d="M12 12L3 12a9 9 0 009 9z"/><path d="M12 12L12 3A9 9 0 003 12z"/></svg></button>
                      </div>
                    </div>
                    <div class="tm-card-body">
                      <!-- Use admin chart key 'stage' for Done/Review/In Progress/To Do -->
                      <canvas id="tm_ad_chart_stage"></canvas>
                    </div>
                  </div>

                  <div class="tm-card">
                    <div class="tm-card-head">Highlights</div>
                    <div class="tm-card-body small">
                      <div class="d-flex justify-content-between"><span>Documentation</span><strong>80%</strong></div>
                      <div class="progress my-2" style="height:6px;"><div class="progress-bar" style="width:80%"></div></div>

                      <div class="d-flex justify-content-between"><span>Recommendations</span><strong>90%</strong></div>
                      <div class="progress my-2" style="height:6px;"><div class="progress-bar bg-success" style="width:90%"></div></div>

                      <div class="d-flex justify-content-between"><span>Planning</span><strong>5</strong></div>
                      <div class="d-flex justify-content-between"><span>Backlog</span><strong>29</strong></div>
                      <div class="d-flex justify-content-between"><span>Payslips</span><strong>30</strong></div>
                    </div>
                  </div>

                </div>
              </div>

              <!-- Shared modal for expanded chart (reuse admin modal) -->
              <div class="modal fade" id="tm_ad_modal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">—</h5>
                      <div class="tm-card-tools ms-3">
                        <button class="tm-ct" data-type="bar" title="Bar"><svg viewBox="0 0 24 24"><rect x="3" y="10" width="4" height="11"/><rect x="10" y="6" width="4" height="15"/><rect x="17" y="2" width="4" height="19"/></svg></button>
                        <button class="tm-ct" data-type="bar-h" title="Horizontal"><svg viewBox="0 0 24 24"><rect y="4" x="3" width="18" height="3"/><rect y="10.5" x="3" width="12" height="3"/><rect y="17" x="3" width="8" height="3"/></svg></button>
                        <button class="tm-ct" data-type="line" title="Line"><svg viewBox="0 0 24 24"><path d="M3 18l6-7 4 3 8-9" fill="none" stroke="currentColor" stroke-width="2"/></svg></button>
                        <button class="tm-ct" data-type="pie" title="Pie"><svg viewBox="0 0 24 24"><path d="M12 12V3a9 9 0 019 9z"/><path d="M12 12L3 12a9 9 0 009 9z"/><path d="M12 12L12 3A9 9 0 003 12z"/></svg></button>
                        <button class="tm-ct" data-type="doughnut" title="Doughnut"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="12" r="4"/></svg></button>
                        <button class="tm-ct tm-ct-collapse" data-action="collapse" title="Collapse"><svg viewBox="0 0 24 24"><path d="M4 9V4h5M20 9V4h-5M4 15v5h5M20 15v5h-5" fill="none" stroke="currentColor" stroke-width="2"/></svg></button>
                      </div>
                    </div>
                    <div class="modal-body">
                      <div class="tm-modal-canvas-wrap">
                        <canvas id="tm_ad_modal_canvas"></canvas>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

				<!-- Add anywhere inside #portal-dashboard-content (e.g., at the end) -->
				<div class="d-none">
					<canvas id="tm_ad_chart_priority"></canvas>
					<canvas id="tm_ad_chart_overdue_mgr"></canvas>
					<canvas id="tm_ad_chart_emp_overdue"></canvas>
					<canvas id="tm_ad_chart_mgr_done"></canvas>
				</div>

            </div>
          </div>

        </section>
      </t>
    </template>
  </data>
</odoo>
