<odoo>

    <!-- <record id="paperformat_report_monthly_expenditure" model="report.paperformat">
      <field name="name">Monthly Expenditure Report Format</field>
      <field name="default" eval="True"/>
      <field name="format">A4</field>
      <field name="page_height">0</field>
      <field name="page_width">0</field>
      <field name="orientation">Portrait</field>
      <field name="margin_top">15</field>
      <field name="margin_bottom">15</field>
      <field name="margin_left">10</field>
      <field name="margin_right">10</field>
      <field name="header_line" eval="False"/>
      <field name="header_spacing">0</field>
      <field name="dpi">96</field>
    </record> -->
    

    <template id="report_expenditure_monthly_template">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <t t-foreach="data" t-as="report">
                    <div class="page">
                        <div class="text-left mb-4">
                            <h3 style="font-size: 14px; font-weight: bold; margin-bottom: 8px;">
                                <t t-esc="report.get('title')"/>
                            </h3>
                            <h4 style="font-size: 14px; font-weight: bold; margin-top: 0;">
                                <t t-esc="subtitle"/>
                            </h4>
                        </div>
                        
                        <style>
                            .report-table { border-collapse: collapse; width: 100%; font-size: 10px; }
                            .report-table th, .report-table td { border: 1px solid #000; padding: 4px 6px; vertical-align: middle; }
                            .report-table th { background-color: #e6e6e6; font-weight: bold; text-align: center; }
                            .text-right { text-align: right !important; }
                            .text-center { text-align: center !important; }
                            .text-left { text-align: left !important; }
                            .parent-level { background-color: #f8f8f8; }
                            .account-row { font-style: italic; }
                        </style>

                        <table class="report-table mt-3">
                            <thead>
                                <tr>
                                    <th style="width: 12%; text-align: center;">Sub-Head</th>
                                    <th style="width: 35%; text-align: left;">Description</th>
                                    <th style="width: 15%; text-align: right;">Previous<br/>Actual</th>
                                    <t t-if="len(month_headers) == 1">
                                        <th style="width: 18%; text-align: right;">
                                            Exp. for the<br/>Month of <t t-esc="month_headers[0].capitalize()"/>
                                        </th>
                                    </t>
                                    <t t-else="">
                                        <t t-foreach="month_headers" t-as="month">
                                            <th style="width: 12%; text-align: right;"><t t-esc="month"/></th>
                                        </t>
                                    </t>
                                    <th style="width: 20%; text-align: right;">Total Actual<br/>Exp. to Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="report.get('report_lines')" t-as="line">
                                    <t t-set="is_account" t-value="line.get('is_acc') == 'yes'"/>
                                    <t t-set="is_parent" t-value="line.get('level', 0) == 0"/>
                                    
                                    <tr t-att-class="'parent-level' if is_parent else ''" t-att-style="'font-weight: bold;' if is_account else ''">
                                        
                                        <td class="text-center">
                                            <span t-esc="line.get('code', '')"/>
                                        </td>
                                        <td class="text-left">
                                            <span t-esc="line.get('name', '')" t-att-class="'account-row' if is_account else ''"/>
                                        </td>
                                        <td class="text-right">
                                            <span t-esc="'{:,.2f}'.format(line.get('previous_actual', 0.0))"/>
                                        </td>
                                        <t t-foreach="month_headers" t-as="month">
                                            <td class="text-right">
                                                <span t-esc="'{:,.2f}'.format(line.get('monthly_values', {}).get(month, 0.0))"/>
                                            </td>
                                        </t>
                                        <td class="text-right">
                                            <span t-esc="'{:,.2f}'.format(line.get('total_exp_to_date', 0.0))"/>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                        
                        <div class="mt-4 text-right" style="font-size: 10px; color: #666;">
                            <p>Report generated on: <span t-esc="datetime.datetime.now().strftime('%B %d, %Y')"/></p>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>
    

    <template id="report_expenditure_quarterly_template">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <t t-foreach="data" t-as="report">
                    <div class="page">
                        <div class="text-left mb-4">
                            <h3 style="font-size: 14px; font-weight: bold; margin-bottom: 8px;">
                                <t t-esc="report.get('title')"/>
                            </h3>
                            <h4 style="font-size: 14px; font-weight: bold; margin-top: 0;">
                                <t t-esc="subtitle"/>
                            </h4>
                        </div>
                        
                        <style>
                            .report-table { border-collapse: collapse; width: 100%; font-size: 9px; }
                            .report-table th, .report-table td { border: 1px solid #000; padding: 4px; vertical-align: middle; }
                            .report-table th { background-color: #e6e6e6; font-weight: bold; text-align: center; }
                            .text-right { text-align: right !important; }
                            .text-center { text-align: center !important; }
                            .text-left { text-align: left !important; }
                            .account-row { font-style: italic; }
                        </style>

                        <table class="report-table mt-3">
                            <thead>
                                <tr>
                                    <th style="width: 12%;">Sub-Head</th>
                                    <th style="width: 35%;">Description</th>
                                    <t t-foreach="month_headers" t-as="month">
                                        <th style="width: 15%;" class="text-right"><t t-esc="month"/></th>
                                    </t>
                                    <th style="width: 18%;" class="text-right">
                                        <t t-if="quarterly_total_header">
                                            <t t-esc="quarterly_total_header"/>
                                        </t>
                                        <t t-else="">
                                            Total
                                        </t>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="report.get('report_lines')" t-as="line">
                                    <t t-set="is_account" t-value="line.get('is_acc') == 'yes'"/>
                                    <tr t-att-style="'font-weight: bold;' if is_account else ''">
                                        <td class="text-center"><span t-esc="line.get('code', '')"/></td>
                                        
                                        <td class="text-left">
                                            <span t-esc="line.get('name', '')" t-att-class="'account-row' if is_account else ''"/>
                                        </td>
                                        
                                        <t t-foreach="month_headers" t-as="month">
                                        <td class="text-right">
                                            <span t-esc="'{:,.2f}'.format(line.get('monthly_values', {}).get(month, 0.0))"/>
                                        </td>
                                    </t>
                                    
                                    <td class="text-right">
                                        <span t-esc="'{:,.2f}'.format(line.get('quarterly_total', 0.0) if line.get('quarterly_total') else line.get('total_exp_to_date', 0.0))"/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </div>
            </t>
        </t>
    </t>
</template>

    <template id="report_total_monthly_template">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <t t-foreach="data" t-as="report">
                    <div class="page">
                        <div class="text-left mb-4">
                            <h3 style="font-size: 14px; font-weight: bold; margin-bottom: 8px;"><t t-esc="report.get('title')"/></h3>
                            <h4 style="font-size: 14px; font-weight: bold; margin-top: 0;"><t t-esc="subtitle"/></h4>
                        </div>
                        <style>.report-table { border-collapse: collapse; width: 100%; font-size: 9px; } .report-table th, .report-table td { border: 1px solid #000; padding: 4px; vertical-align: middle; } .report-table th { background-color: #e6e6e6; font-weight: bold; text-align: center; } .text-right { text-align: right !important; } .capital-header { background-color: #f2f2f2; font-weight: bold; text-align:center; }</style>
                        <table class="report-table mt-3">
                            <thead>
                                <tr>
                                    <th style="width: 25%;">CODE</th>
                                    <th style="width: 20%;">DESCRIPTION</th>
                                    <t t-foreach="district_headers" t-as="district"><th style="width: 13%;" class="text-right"><t t-esc="district"/> DISTRICT</th></t>
                                    <th style="width: 13%;" class="text-right">TOTAL REV.</th>
                                    <th style="width: 13%;" class="text-right">TOTAL EXP.</th>
                                    <th style="width: 13%;" class="text-right">BALANCE</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="report.get('report_lines')" t-as="line">
                                    <tr>
                                        <td><span t-esc="line.get('code', '')"/></td>
                                        <td><span t-esc="line.get('description', '')"/></td>
                                        <t t-foreach="month_headers" t-as="month"><td class="text-right"><span t-esc="'{:,.2f}'.format(line.get('district_values', {}).get(district, 0.0))"/></td></t>
                                        <td class="text-right"><span t-esc="'{:,.2f}'.format(line.get('total_exp_to_date', 0.0))"/></td>
                                        <td class="text-right"><span t-esc="'{:,.2f}'.format(line.get('balance', 0.0))"/></td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <template id="report_total_quarterly_template">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <t t-foreach="data" t-as="report">
                    <div class="page">
                        <div class="text-left mb-4">
                            <h3 style="font-size: 14px; font-weight: bold; margin-bottom: 8px;"><t t-esc="report.get('title')"/></h3>
                            <h4 style="font-size: 14px; font-weight: bold; margin-top: 0;"><t t-esc="subtitle"/></h4>
                        </div>
                        <style>.report-table { border-collapse: collapse; width: 100%; font-size: 9px; } .report-table th, .report-table td { border: 1px solid #000; padding: 4px; vertical-align: middle; } .report-table th { background-color: #e6e6e6; font-weight: bold; text-align: center; } .text-right { text-align: right !important; } .text-center { text-align: center !important; } .capital-header { background-color: #f2f2f2; font-weight: bold; text-align:center; }</style>
                        <table class="report-table mt-3">
                            <thead>
                                <tr>
                                    <th style="width: 25%;">Code</th>
                                    <th style="width: 20%;">DESCRIPTION</th>
                                    <t t-foreach="district_headers" t-as="district"><th style="width: 9%;" class="text-right"><t t-esc="district"/></th></t>
                                    <th style="width: 10%;" class="text-right"><t t-esc="quarterly_total_header"/></th>
                                    <th style="width: 7%;">% PERF TO DATE</th>
                                    <th style="width: 11%;" class="text-right">BALANCE</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="report.get('report_lines')" t-as="line">
                                    <tr>
                                        <td><span t-esc="line.get('code', '')"/></td>
                                        <td><span t-esc="line.get('description', '')"/></td>
                                        <t t-foreach="month_headers" t-as="month"><td class="text-right"><span t-esc="'{:,.2f}'.format(line.get('district_values', {}).get(district, 0.0))"/></td></t>
                                        <td class="text-right"><span t-esc="'{:,.2f}'.format(line.get('quarterly_total', 0.0))"/></td>
                                        <td class="text-center"><span t-esc="'{:.2f}%'.format(line.get('percentage_perf', 0.0))"/></td>
                                        <td class="text-right"><span t-esc="'{:,.2f}'.format(line.get('balance', 0.0))"/></td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <template id="consolidated_district_report_template">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <t t-foreach="data" t-as="report">
                    <div class="page">
                        <div class="text-center mb-4">
                            <h2 style="font-size: 16px; font-weight: bold; margin-bottom: 8px;">
                                <t t-esc="report.get('company_name', 'MAIN POWER')"/>
                            </h2>
                            <h3 style="font-size: 14px; font-weight: bold; margin-bottom: 8px;">
                                CONSOLIDATED DISTRICT REPORT
                            </h3>
                            <h4 style="font-size: 12px; font-weight: bold; margin-top: 0;">
                                <t t-esc="report.get('subtitle')"/>
                            </h4>
                        </div>

                        <style>
                            .consolidated-table {
                                border-collapse: collapse;
                                width: 100%;
                                font-size: 10px;
                                margin-top: 20px;
                            }
                            .consolidated-table th, .consolidated-table td {
                                border: 1px solid #000;
                                padding: 6px;
                                vertical-align: middle;
                            }
                            .consolidated-table th {
                                background-color: #e6e6e6;
                                font-weight: bold;
                                text-align: center;
                                font-size: 9px;
                            }
                            .text-right {
                                text-align: right !important;
                            }
                            .text-center {
                                text-align: center !important;
                            }
                            .expandable-row {
                                cursor: pointer;
                                background-color: #f8f9fa;
                                font-weight: bold;
                            }
                            .expandable-row:hover {
                                background-color: #e9ecef;
                            }
                            .move-detail-row {
                                display: none;
                                background-color: #fff;
                                font-size: 9px;
                                font-weight: normal;
                            }
                            .move-detail-row.show {
                                display: table-row;
                            }
                            .expand-icon {
                                font-weight: bold;
                                font-size: 12px;
                                margin-right: 5px;
                                color: #007bff;
                                display: inline-block;
                                transition: transform 0.2s;
                            }
                            .expand-icon.expanded {
                                transform: rotate(90deg);
                            }
                            .indent-move {
                                padding-left: 30px;
                                font-style: italic;
                                color: #666;
                            }
                            .total-row {
                                background-color: #d4edda;
                                font-weight: bold;
                                border-top: 2px solid #000;
                            }
                            .account-code {
                                font-family: 'Courier New', monospace;
                                font-weight: bold;
                            }
                            .move-reference {
                                font-size: 8px;
                                color: #666;
                            }
                        </style>

                        <script type="text/javascript">
                            document.addEventListener('DOMContentLoaded', function() {
                                window.toggleAccountDetails = function(accountCode) {
                                    // Use the accountCode directly, as it's already sanitized in QWeb
                                    var detailRows = document.querySelectorAll('.moves-' + accountCode);
                                    var icon = document.getElementById('icon-' + accountCode);
                                    
                                    if (!detailRows.length || !icon) return;
                                    
                                    var isVisible = detailRows[0].classList.contains('show');
                                    
                                    detailRows.forEach(function(row) {
                                        if (isVisible) {
                                            row.classList.remove('show');
                                        } else {
                                            row.classList.add('show');
                                        }
                                    });
                                    
                                    // Toggle icon
                                    if (isVisible) {
                                        icon.classList.remove('expanded');
                                    } else {
                                        icon.classList.add('expanded');
                                    }
                                };
                            });
                        </script>

                        <table class="consolidated-table">
                            <thead>
                                <tr>
                                    <th style="width: 15%;">CHART OF ACCOUNT</th>
                                    <th style="width: 25%;">DESCRIPTION</th>
                                    <t t-foreach="report.get('district_headers', [])" t-as="district">
                                        <th style="width: 8%;" class="text-right">
                                            <t t-esc="district"/> DISTRICT
                                        </th>
                                    </t>
                                    <th style="width: 10%;" class="text-right">TOTAL REV.</th>
                                    <th style="width: 10%;" class="text-right">TOTAL EXP.</th>
                                    <th style="width: 12%;" class="text-right">BALANCE</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="report.get('report_lines', [])" t-as="line">
                                    <t t-set="safe_account_code" t-value="str(line.get('code', '')).replace('.', '_').replace('-', '_').replace(' ', '_')"/>
                                    
                                    <tr class="expandable-row" style="cursor: pointer;" 
                                        t-att-onclick="'toggleAccountDetails(\'' + safe_account_code + '\')'">
                                        <td>
                                            <span t-attf-id="icon-#{safe_account_code}" class="expand-icon">‚ñ∂</span>
                                            <span class="account-code" t-esc="line.get('code', '')"/>
                                        </td>
                                        <td>
                                            <strong t-esc="line.get('description', '')"/>
                                        </td>
                                        <t t-foreach="report.get('district_headers', [])" t-as="district">
                                            <td class="text-right">
                                                <strong t-esc="'{:,.2f}'.format(line.get('district_values', {}).get(district, 0.0))"/>
                                            </td>
                                        </t>
                                        <td class="text-right">
                                            <strong t-esc="'{:,.2f}'.format(line.get('total_revenue', 0.0))"/>
                                        </td>
                                        <td class="text-right">
                                            <strong t-esc="'{:,.2f}'.format(line.get('total_expenditure', 0.0))"/>
                                        </td>
                                        <td class="text-right">
                                            <strong t-esc="'{:,.2f}'.format(line.get('balance', 0.0))"/>
                                        </td>
                                    </tr>

                                    <t t-foreach="report.get('district_headers', [])" t-as="district">
                                        <t t-set="district_moves" t-value="line.get('move_details', {}).get(district, [])"/>
                                        <t t-if="district_moves">
                                            <tr t-attf-class="move-detail-row moves-#{safe_account_code}" 
                                                style="background-color: #e8f4f8;">
                                                <td class="indent-move" colspan="2">
                                                    <strong>üìç <t t-esc="district"/> District Transactions:</strong>
                                                </td>
                                                <td colspan="5" class="text-right">
                                                    <strong>Count: <t t-esc="len(district_moves)"/> transactions</strong>
                                                </td>
                                            </tr>
                                            
                                            <t t-foreach="district_moves" t-as="move">
                                                <tr t-attf-class="move-detail-row moves-#{safe_account_code}">
                                                    <td class="indent-move">
                                                        <span class="move-reference">
                                                            <t t-esc="move.get('date', '')"/>
                                                        </span>
                                                    </td>
                                                    <td class="indent-move">
                                                        <div>
                                                            <strong><t t-esc="move.get('description', '')[:50]"/>
                                                            <t t-if="len(move.get('description', '')) > 50">...</t></strong>
                                                        </div>
                                                        <div class="move-reference">
                                                            Ref: <t t-esc="move.get('reference', '')"/>
                                                            <t t-if="move.get('partner')"> | Partner: <t t-esc="move.get('partner')"/></t>
                                                        </div>
                                                    </td>
                                                    <t t-foreach="report.get('district_headers', [])" t-as="other_district">
                                                        <td class="text-right">
                                                            <t t-if="other_district == district">
                                                                <span t-esc="'{:,.2f}'.format(move.get('balance', 0.0))"/>
                                                            </t>
                                                            <t t-else="">-</t>
                                                        </td>
                                                    </t>
                                                    <td class="text-right">
                                                        <span t-esc="'{:,.2f}'.format(move.get('credit', 0.0))"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-esc="'{:,.2f}'.format(move.get('debit', 0.0))"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-esc="'{:,.2f}'.format(move.get('credit', 0.0) - move.get('debit', 0.0))"/>
                                                    </td>
                                                </tr>
                                            </t>
                                        </t>
                                    </t>
                                </t>
                                
                                <tr class="total-row">
                                    <td colspan="2"><strong>GRAND TOTAL</strong></td>
                                    <t t-foreach="report.get('district_headers', [])" t-as="district">
                                        <td class="text-right">
                                            <strong>
                                                <t t-set="district_total" t-value="sum([line.get('district_values', {}).get(district, 0.0) for line in report.get('report_lines', [])])"/>
                                                <span t-esc="'{:,.2f}'.format(district_total)"/>
                                            </strong>
                                        </td>
                                    </t>
                                    <td class="text-right">
                                        <strong>
                                            <t t-set="total_revenue" t-value="sum([line.get('total_revenue', 0.0) for line in report.get('report_lines', [])])"/>
                                            <span t-esc="'{:,.2f}'.format(total_revenue)"/>
                                        </strong>
                                    </td>
                                    <td class="text-right">
                                        <strong>
                                            <t t-set="total_expenditure" t-value="sum([line.get('total_expenditure', 0.0) for line in report.get('report_lines', [])])"/>
                                            <span t-esc="'{:,.2f}'.format(total_expenditure)"/>
                                        </strong>
                                    </td>
                                    <td class="text-right">
                                        <strong>
                                            <span t-esc="'{:,.2f}'.format(total_revenue - total_expenditure)"/>
                                        </strong>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <div style="margin-top: 20px; font-size: 9px; color: #666;">
                            <p><strong>Instructions:</strong></p>
                            <ul>
                                <li>Click on any account row (with ‚ñ∂ arrow) to expand/collapse detailed transactions</li>
                                <li>Each district's transactions are grouped separately when expanded</li>
                                <li>Transaction details include date, description, reference, and partner information</li>
                            </ul>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

        <record id="action_report_expenditure_monthly" model="ir.actions.report">
            <field name="name">Monthly Expenditure Report</field>
            <field name="model">account.dynamic.report</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">eedc_report.report_expenditure_monthly_template</field>
            <field name="report_file">eedc_report.report_expenditure_monthly_template</field>
        <!-- <field name="paperformat_id" ref="eedc_report.paperformat_report_monthly_expenditure"/> -->
        </record>
        
        <record id="action_report_expenditure_quarterly" model="ir.actions.report">
            <field name="name">Quarterly Expenditure Report</field>
            <field name="model">account.dynamic.report</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">eedc_report.report_expenditure_quarterly_template</field>
            <field name="report_file">eedc_report.report_expenditure_quarterly_template</field>
            <field name="binding_model_id" eval="False"/>
        </record>

        <record id="action_consolidated_district_report" model="ir.actions.report">
            <field name="name">Consolidated District Report</field>
            <field name="model">account.dynamic.report</field>
            <field name="report_type">qweb-html</field>
            <field name="report_name">eedc_report.consolidated_district_report_template</field>
            <field name="report_file">eedc_report.consolidated_district_report_template</field>
            <field name="binding_model_id" ref="model_account_dynamic_report"/>
            <field name="binding_type">report</field>
        </record>

        <record id="action_report_capital_monthly" model="ir.actions.report">
            <field name="name">Monthly Capital Report</field>
            <field name="model">account.dynamic.report</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">eedc_report.report_capital_monthly_template</field>
            <field name="report_file">eedc_report.report_capital_monthly_template</field>
        </record>

        <record id="action_report_capital_quarterly" model="ir.actions.report">
            <field name="name">Quarterly Capital Report</field>
            <field name="model">account.dynamic.report</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">eedc_report.report_capital_quarterly_template</field>
            <field name="report_file">eedc_report.report_capital_quarterly_template</field>
            <field name="binding_model_id" eval="False"/>
        </record>
</odoo>
