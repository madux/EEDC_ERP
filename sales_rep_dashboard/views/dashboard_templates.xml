<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <template id="dashboard_page" name="Sales Rep Dashboard">
    <t t-call="website.layout">

      <div class="o_container_sm sales-rep-dashboard container-xxl py-3">

        <!-- ========================= -->
        <!-- Toolbar / Filters -->
        <!-- ========================= -->
        <div class="dash-toolbar glassy mb-4 p-3 p-md-4">
            <!-- FILTER ROW -->
            <div class="filter-row row g-3 align-items-end mb-2">
                <!-- Date From -->
                <div class="col-12 col-sm-6 col-md-3">
                <label class="form-label text-secondary fw-semibold mb-1 small">
                    <i class="fa fa-calendar"></i> Date From
                </label>
                <input type="date" class="form-control filter-input" id="srd-date-from" />
                </div>

                <!-- Date To -->
                <div class="col-12 col-sm-6 col-md-3">
                <label class="form-label text-secondary fw-semibold mb-1 small">
                    <i class="fa fa-calendar-o"></i> Date To
                </label>
                <input type="date" class="form-control filter-input" id="srd-date-to" />
                </div>

                <!-- Search -->
                <div class="col-12 col-md-6">
                <div class="input-wrapper position-relative">
                    <input
                    type="text"
                    class="form-control filter-input ps-5"
                    id="srd-search"
                    placeholder="Search order or customer..."
                    />
                    <i class="fa fa-search search-icon"></i>
                </div>
                </div>
            </div>

            <!-- ACTION ROW -->
            <div class="action-row d-flex flex-wrap justify-content-end gap-2">
                <button class="btn gradient" id="srd-apply">
                <i class="fa fa-filter me-1"></i> Apply
                </button>
                <button class="btn btn-outline-secondary" id="srd-reset">
                <i class="fa fa-refresh me-1"></i> Reset
                </button>
                <button class="btn btn-outline-primary export-btn" id="srd-export">
                <i class="fa fa-download me-1"></i> Export CSV
                </button>
            </div>
        </div>

        <!-- ========================= -->
        <!-- User Profile Header -->
        <!-- ========================= -->
        <div class="card glassy mb-4 p-4 profile-header" t-att-data-user="request.env.user.id">
            <div class="d-flex align-items-center flex-wrap gap-4">
                <!-- Avatar -->
                <div class="profile-avatar">
                <img t-att-src="'/web/image/res.users/%s/image_1920' % request.env.user.id"
                    alt="User" class="rounded-circle shadow-sm" width="90" height="90"/>
                </div>

                <!-- Info -->
                <div class="flex-grow-1 profile-info">
                <h4 class="user-name mb-1">
                    <t t-esc="request.env.user.name"/>
                    <span class="badge status-badge bg-success ms-2">Active</span>
                </h4>

                <div class="user-meta text-muted small mb-2">
                    <t t-if="request.env.user.employee_ids">
                        <t t-set="emp" t-value="request.env.user.employee_ids[0]"/>

                        <!-- Department -->
                        <span class="me-3 d-inline-flex align-items-center">
                        <i class="fa fa-building me-1 text-primary"></i>
                        <span class="fw-semibold text-secondary me-1">Department:</span>
                        <span><t t-esc="emp.department_id.name or '—'"/></span>
                        </span>

                        <!-- Role -->
                        <span class="me-3 d-inline-flex align-items-center">
                        <i class="fa fa-id-badge me-1 text-info"></i>
                        <span class="fw-semibold text-secondary me-1">Role:</span>
                        <span><t t-esc="emp.job_title or '—'"/></span>
                        </span>

                        <!-- Manager -->
                        <span class="d-inline-flex align-items-center">
                        <i class="fa fa-user-secret me-1 text-purple"></i>
                        <span class="fw-semibold text-secondary me-1">Manager:</span>
                        <span><t t-esc="emp.parent_id.name or '—'"/></span>
                        </span>
                    </t>

                    <t t-if="not request.env.user.employee_ids">
                        Department: — | Role: — | Manager: —
                    </t>
                </div>


                <div class="text-secondary small">
                    <i class="fa fa-calendar me-1"></i> As of <t t-esc="(datetime.datetime.now()).strftime('%b %d, %Y')"/>
                </div>
                </div>

                <!-- TODO: Edit Profile not functional now (future) -->
                <div class="profile-actions text-md-end ms-auto">
                <button class="btn btn-sm btn-outline-primary">
                    <i class="fa fa-edit me-1"></i> Edit Profile
                </button>
                </div>
            </div>
        </div>



        <!-- KPI cards -->
        <div class="row g-3 mb-2">
          <div class="col-6 col-md-4 col-xl-2">
            <div class="kpi card glassy quotations">
                <div class="icon"><i class="fa fa-file-text-o"></i></div>
                <div>
                    <div class="kpi-label">Quotations</div>
                    <div class="kpi-value" id="kpi-quotations">0</div>
                    <div class="kpi-change text-success small" id="kpi-quotations-change">+0%</div>
                </div>
            </div>
            </div>

            <div class="col-6 col-md-4 col-xl-2">
            <div class="kpi card glassy sales-won">
                <div class="icon"><i class="fa fa-trophy"></i></div>
                <div>
                    <div class="kpi-label">Sales Won</div>
                    <div class="kpi-value" id="kpi-won">0</div>
                    <div class="kpi-change text-success small" id="kpi-quotations-change">+0%</div>
                </div>
            </div>
            </div>

            <div class="col-6 col-md-4 col-xl-2">
            <div class="kpi card glassy customers">
                <div class="icon"><i class="fa fa-users"></i></div>
                <div>
                    <div class="kpi-label">Customers</div>
                    <div class="kpi-value" id="kpi-customers">0</div>
                    <div class="kpi-change text-success small" id="kpi-quotations-change">+0%</div>
                </div>
            </div>
            </div>

            <div class="col-6 col-md-4 col-xl-3">
            <div class="kpi card glassy total-won">
                <div class="icon"><i class="fa fa-money"></i></div>
                <div>
                    <div class="kpi-label">Total Won</div>
                    <div class="kpi-value" id="kpi-total-won">0</div>
                    <div class="kpi-change text-success small" id="kpi-quotations-change">+0%</div>
                </div>
            </div>
            </div>

            <div class="col-6 col-md-4 col-xl-3">
            <div class="kpi card glassy forecast">
                <div class="icon"><i class="fa fa-line-chart"></i></div>
                <div>
                    <div class="kpi-label">Forecast</div>
                    <div class="kpi-value" id="kpi-forecast">0</div>
                    <div class="kpi-change text-success small" id="kpi-quotations-change">+0%</div>
                </div>
            </div>
            </div>

        </div>

        <!-- Charts grid -->
        <div class="row g-3 mb-3">
          <div class="col-lg-6">
            <div class="card glassy p-3 h-100">
              <div class="card-title d-flex justify-content-between align-items-center mb-2">
                <span><i class="fa fa-bar-chart"></i> Pipeline by Month</span>
                <i class="fa fa-line-chart"></i>
              </div>
              <canvas id="chart-pipeline" height="220" data-testid="chart-pipeline"></canvas>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="card glassy p-3 h-100">
              <div class="card-title d-flex justify-content-between align-items-center mb-2">
                <span><i class="fa fa-users"></i> Top Customers</span>
              </div>
              <canvas id="chart-top-customers" height="220" data-testid="chart-top-customers"></canvas>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="card glassy p-3 h-100">
              <div class="card-title d-flex justify-content-between align-items-center mb-2">
                <span><i class="fa fa-line-chart"></i> Forecast (Next 3 Months)</span>
              </div>
              <canvas id="chart-forecast" height="220" data-testid="chart-forecast"></canvas>
            </div>
          </div>
        </div>

        <!-- Sales table -->
        <div class="card glassy p-0" data-testid="sales-table">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
              <thead class="small text-uppercase text-muted">
                <tr>
                  <th>Order</th>
                  <th>Customer</th>
                  <th>Status</th>
                  <th>Date</th>
                  <th class="text-end">Untaxed</th>
                  <th class="text-end">Total</th>
                  <th>Forecast</th>
                </tr>
              </thead>
              <tbody id="srd-tbody"></tbody>
            </table>
          </div>

          <div class="d-flex justify-content-between align-items-center p-3">
            <div class="small text-muted" id="srd-pager-info">0–0 of 0</div>
            <div class="btn-group">
              <button class="btn btn-outline-secondary btn-sm" id="srd-prev">Prev</button>
              <button class="btn btn-outline-secondary btn-sm" id="srd-next">Next</button>
            </div>
          </div>
        </div>

      </div>
    </t>
  </template>
</odoo>
