<!-- wizard/rfq_upload_wizard.xml -->
<?xml version="1.0" encoding="utf-8"?>
<odoo>
   
    <!-- RFQ Upload Wizard Form View -->
    <record id="view_rfq_upload_wizard_form" model="ir.ui.view">
        <field name="name">rfq.upload.wizard.form</field>
        <field name="model">rfq.upload.wizard</field>
        <field name="arch" type="xml">
            <form string="Upload RFQ Excel">
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <i class="fa fa-upload text-primary"/>
                            Upload RFQ Excel File
                        </h1>
                        <p class="text-muted">Upload vendor quotations from Excel file</p>
                    </div>
                   
                    <!-- State indicator -->
                    <div class="oe_button_box" name="button_box">
                        <field name="state" widget="statusbar" statusbar_visible="draft,validating,validated,processing,done"/>
                    </div>
                   
                    <group>
                        <group>
                            <field name="memo_id" readonly="1" widget="selection"/>
                        </group>
                        <group>
                            <field name="rfq_excel_file"
                                   widget="binary"
                                   filename="rfq_excel_filename"
                                   required="1"
                                   accept=".xlsx,.xls"
                                   attrs="{'readonly': [('state', 'in', ['processing', 'done'])]}"/>
                            <field name="rfq_excel_filename" invisible="1"/>
                        </group>
                    </group>

                    <!-- Processing Options -->
                    <group string="Processing Options" attrs="{'invisible': [('state', 'in', ['processing', 'done'])]}">
                        <group>
                            <field name="validate_only"/>
                            <field name="create_missing_products"/>
                        </group>
                        <group>
                            <field name="create_missing_vendors"/>
                            <field name="group_by_vendor"/>
                        </group>
                    </group>
                   
                    <notebook>
                        <page name="instructions" string="Instructions" attrs="{'invisible': [('state', 'not in', ['draft'])]}">
                            <div class="alert alert-info">
                                <h4><i class="fa fa-info-circle"/> Instructions</h4>
                                <ol>
                                    <li><strong>Download Template:</strong> Click "Download Template" to get the Excel template</li>
                                    <li><strong>Fill Data:</strong> Complete all required columns with accurate vendor and product information</li>
                                    <li><strong>Vendor Info:</strong> Ensure vendor emails and phone numbers are valid</li>
                                    <li><strong>Products:</strong> Use existing product codes or provide product names for new product creation</li>
                                    <li><strong>Upload:</strong> Select the completed Excel file and click "Upload &amp; Process"</li>
                                </ol>
                            </div>
                           
                            <div class="alert alert-warning">
                                <h4><i class="fa fa-exclamation-triangle"/> Required Columns</h4>
                                <div class="row">
                                    <div class="col-md-6">
                                        <strong>Vendor Information:</strong>
                                        <ul>
                                            <li>VENDOR CODE</li>
                                            <li>VENDOR NAME</li>
                                            <li>VENDOR EMAIL</li>
                                            <li>VENDOR PHONE</li>
                                            <li>VENDOR ADDRESS</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <strong>Product Information:</strong>
                                        <ul>
                                            <li>PRODUCT CODE</li>
                                            <li>PRODUCT NAME</li>
                                            <li>QTY TO SUPPLY</li>
                                            <li>PRICE PER QUANTITY</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                           
                            <div class="alert alert-success">
                                <h4><i class="fa fa-lightbulb-o"/> Tips for Better Results</h4>
                                <ul>
                                    <li>Use consistent vendor names to avoid duplicate vendor creation</li>
                                    <li>Provide valid email addresses for automatic vendor communication</li>
                                    <li>Use existing product codes when possible to link with current inventory</li>
                                    <li>Ensure numeric values for quantities and prices (no text or special characters)</li>
                                    <li>Validate your file before processing to catch errors early</li>
                                </ul>
                            </div>
                        </page>

                        <!-- Validation Results Page -->
                        <page name="validation_results" 
                              string="Validation Results" 
                              attrs="{'invisible': [('validation_result', '=', '')]}">
                            <group>
                                <field name="validation_result" 
                                       widget="text" 
                                       readonly="1"
                                       nolabel="1"
                                       attrs="{'invisible': [('validation_result', '=', '')]}"/>
                            </group>
                        </page>

                        <!-- Processing Results Page -->
                        <page name="processing_results" 
                              string="Processing Results" 
                              attrs="{'invisible': [('processing_result', '=', '')]}">
                            <group>
                                <field name="processing_result" 
                                       widget="text" 
                                       readonly="1"
                                       nolabel="1"
                                       attrs="{'invisible': [('processing_result', '=', '')]}"/>
                            </group>
                        </page>
                    </notebook>

                    <!-- Hidden fields for state management -->
                    <field name="state" invisible="1"/>
                </sheet>
                
                <footer>
                    <!-- Download Template Button -->
                    <button name="action_download_template" 
                            string="Download Template" 
                            type="object" 
                            class="btn-info"
                            icon="fa-download"
                            attrs="{'invisible': [('state', 'in', ['processing'])]}"/>
                    
                    <!-- Validate File Button -->
                    <button name="action_validate_file" 
                            string="Validate File" 
                            type="object" 
                            class="btn-warning"
                            icon="fa-check-circle"
                            attrs="{'invisible': [('state', 'in', ['processing', 'done']), ('rfq_excel_file', '=', False)]}"/>
                    
                    <!-- Upload & Process Button -->
                    <button name="action_upload_rfq" 
                            string="Upload &amp; Process" 
                            type="object" 
                            class="btn-primary"
                            icon="fa-upload"
                            attrs="{'invisible': [('rfq_excel_file', '=', False)]}"/>
                    
                    <!-- Reset Button -->
                    <button name="action_reset" 
                            string="Reset" 
                            type="object" 
                            class="btn-secondary"
                            icon="fa-refresh"
                            attrs="{'invisible': [('state', 'in', ['draft', 'processing'])]}"/>
                    
                    <!-- Cancel Button -->
                    <button string="Cancel" 
                            class="btn-secondary" 
                            special="cancel"
                            attrs="{'invisible': [('state', 'in', ['processing'])]}"/>
                    
                    <!-- Close Button (for completed processes) -->
                    <button string="Close" 
                            class="btn-primary" 
                            special="cancel"
                            attrs="{'invisible': [('state', '!=', 'done')]}"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Window Action for RFQ Upload Wizard -->
    <record id="action_rfq_upload_wizard" model="ir.actions.act_window">
        <field name="name">Upload RFQ Excel</field>
        <field name="res_model">rfq.upload.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="view_id" ref="view_rfq_upload_wizard_form"/>
        <field name="context">{'default_memo_id': active_id}</field>
    </record>

    <!-- Menu item (optional - if you want it in the main menu) -->
    <record id="menu_rfq_upload_wizard" model="ir.ui.menu">
        <field name="name">RFQ Upload</field>
        <field name="action" ref="action_rfq_upload_wizard"/>
        <field name="parent_id" ref="purchase.menu_procurement_management"/>
        <field name="sequence" ref="15"/>
    </record>

</odoo>