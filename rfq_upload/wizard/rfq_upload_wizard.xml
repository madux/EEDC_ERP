<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_rfq_upload_wizard_form" model="ir.ui.view">
        <field name="name">rfq.upload.wizard.form</field>
        <field name="model">rfq.upload.wizard</field>
        <field name="arch" type="xml">
            <form string="RFQ Upload Wizard">
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <i class="fa fa-upload text-primary"/>
                            RFQ Upload Wizard
                        </h1>
                        <p class="text-muted">Download template with your request items, get vendor quotations, then upload to create purchase orders</p>
                    </div>
                    
                    <group>
                        <group>
                            <field name="memo_id" readonly="1"/>
                            <field name="rfq_excel_file"
                                   widget="binary"
                                   filename="rfq_excel_filename"
                                   accept=".xlsx,.xls,.csv"
                                   />
                            <field name="rfq_excel_filename" invisible="1"/>
                            <field name="sheet_count" invisible="1"/>
                            <field name="sheet_list" attrs="{'invisible': [('sheet_count', '&lt;=', 1)]}" readonly="1"/>
                            <field name="sheet" attrs="{'invisible': [('sheet_count', '&lt;=', 1)], 'required': [('sheet_count', '>', 1)]}"/>
                        </group>
                        <group>
                            <!-- Empty group for layout -->
                        </group>
                    </group>

                    <group string="Processing Options" attrs="{'invisible': [('rfq_excel_file', '=', False)]}">
                        <group>
                            <field name="create_missing_products"/>
                            <field name="create_missing_vendors"/>
                        </group>
                        <group>
                            <field name="group_by_vendor"/>
                        </group>
                    </group>

                    <!-- Instructions Section -->
                    <div class="alert alert-info" attrs="{'invisible': ['|', ('validation_result', '!=', ''), ('processing_result', '!=', '')]}">
                        <h4><i class="fa fa-info-circle"/> Step-by-Step Instructions</h4>
                        <ol class="mb0">
                            <li><strong>Download Template:</strong> Click "Download Template" button below to get an Excel file pre-populated with your request items</li>
                            <li><strong>Get Vendor Quotes:</strong> Send the template to vendors or fill in vendor quotations manually</li>
                            <li><strong>Complete Vendor Info:</strong> Fill in vendor details (name, email, phone, address) for each quote</li>
                            <li><strong>Set Prices:</strong> Enter the quoted prices from vendors (quantities are already filled from your request)</li>
                            <li><strong>Upload File:</strong> Upload the completed Excel file using the file picker above</li>
                            <li><strong>Validate:</strong> Click "Validate File" to check for errors before processing</li>
                            <li><strong>Process:</strong> Click "Upload &amp; Process" to create purchase orders automatically</li>
                        </ol>
                    </div>
                    
                    <div class="row" attrs="{'invisible': ['|', ('validation_result', '!=', ''), ('processing_result', '!=', '')]}">
                        <div class="col-md-6">
                            <div class="alert alert-success">
                                <h5><i class="fa fa-download"/> Template Features</h5>
                                <ul class="mb0">
                                    <li>Pre-populated with your requested items</li>
                                    <li>Product codes and names already filled</li>
                                    <li>Quantities from your request included</li>
                                    <li>Ready to send to vendors</li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="alert alert-warning">
                                <h5><i class="fa fa-exclamation-triangle"/> Required Information</h5>
                                <strong>You must fill in:</strong>
                                <ul class="mb0">
                                    <li>Vendor Code (required)</li>
                                    <li>Vendor Name (required)</li>
                                    <li>Vendor Email (recommended)</li>
                                    <li>Price Per Unit (required)</li>
                                    <li>Vendor Phone &amp; Address (optional)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info" attrs="{'invisible': ['|', ('validation_result', '!=', ''), ('processing_result', '!=', '')]}">
                        <h5><i class="fa fa-lightbulb-o"/> Pro Tips</h5>
                        <ul class="mb0">
                            <li><strong>Multiple Vendors:</strong> You can quote the same item from different vendors - separate POs will be created</li>
                            <li><strong>Vendor Emails:</strong> Include valid email addresses for automatic vendor communication</li>
                            <li><strong>Consistent Names:</strong> Use consistent vendor names to avoid creating duplicate vendors</li>
                            <li><strong>Validation:</strong> Use "Validate File" button to check for errors before processing</li>
                        </ul>
                    </div>

                    <div attrs="{'invisible': ['&amp;', ('validation_result', '=', ''), ('processing_result', '=', '')]}" class="mt16">

                        <div class="alert alert-info mb8" attrs="{'invisible': [('validation_result', '=', '')]}">
                            <i class="fa fa-check-circle"/> Validation Result
                        </div>

                        <group attrs="{'invisible': [('validation_result', '=', '')]}">
                            <field name="validation_result" widget="text" readonly="1" string="Validation Result"/>
                        </group>

                        <div class="alert alert-info mb8" attrs="{'invisible': [('processing_result', '=', '')]}">
                            <i class="fa fa-check-circle"/> Processing Result
                        </div>

                        <group attrs="{'invisible': [('processing_result', '=', '')]}">
                            <field name="processing_result" widget="text" readonly="1" string="Processing Result"/>
                        </group>

                    </div>


                </sheet>
                
                <footer>
                    <button name="action_download_template" 
                            string="1. Download Template" 
                            type="object" 
                            class="btn-primary"
                            icon="fa-download"
                            />
                    
                    <button name="action_validate_file" 
                            string="2. Validate File" 
                            type="object" 
                            class="btn-warning"
                            icon="fa-check-circle"
                            attrs="{'invisible': [('rfq_excel_file', '=', False)]}"/>
                    
                    <button name="action_upload_rfq" 
                            string="3. Upload &amp; Process" 
                            type="object" 
                            class="btn-success"
                            icon="fa-upload"
                            attrs="{'invisible': [('rfq_excel_file', '=', False)]}"/>
                    
                    <button string="Cancel" 
                            class="btn-secondary" 
                            special="cancel"
                            attrs="{'invisible': [('rfq_excel_file', '!=', False)]}"
                            />
                    
                    <button string="Close" 
                            class="btn-primary" 
                            special="cancel"
                            attrs="{'invisible': [('rfq_excel_file', '=', False)]}"
                            />
                </footer>
            </form>
        </field>
    </record>

    <record id="action_rfq_upload_wizard" model="ir.actions.act_window">
        <field name="name">RFQ Upload Wizard</field>
        <field name="res_model">rfq.upload.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="view_id" ref="view_rfq_upload_wizard_form"/>
        <field name="context">{'default_memo_id': active_id}</field>
    </record>
</odoo>