<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_rfq_upload_wizard_form" model="ir.ui.view">
        <field name="name">rfq.upload.wizard.form</field>
        <field name="model">rfq.upload.wizard</field>
        <field name="arch" type="xml">
            <form string="RFQ Upload Wizard">
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <i class="fa fa-upload text-primary"/>
                            RFQ Upload Wizard
                        </h1>
                        <p class="text-muted">Download template with your request items, get vendor quotations, then upload to create purchase orders</p>
                    </div>
                    
                    <div class="oe_button_box" name="button_box">
                        <field name="state" widget="statusbar" statusbar_visible="draft,validating,validated,processing,done"/>
                    </div>
                    
                    <group>
                        <group>
                            <field name="memo_id" readonly="1"/>
                            <field name="rfq_excel_file"
                                   widget="binary"
                                   filename="rfq_excel_filename"
                                   accept=".xlsx,.xls,.csv"
                                   attrs="{'readonly': [('state', 'in', ['processing', 'done'])]}"/>
                            <field name="rfq_excel_filename" invisible="1"/>
                        </group>
                        <group>
                            <!-- <label for="memo_details" string="Memo Details"/>
                            <div name="memo_details">
                                <div><strong>Request Number:</strong> <field name="memo_id" readonly="1" nolabel="1" widget="char" attrs="{'invisible': [('memo_id', '=', False)]}"/></div>
                                <div><strong>Items in Request:</strong> <span class="text-muted">Will be pre-populated in template</span></div>
                            </div> -->
                        </group>
                    </group>

                    <group string="Processing Options" attrs="{'invisible': [('state', 'in', ['processing', 'done'])]}">
                        <group>
                            <field name="validate_only" help="Check this to only validate the file without creating purchase orders"/>
                            <field name="create_missing_products" attrs="{'invisible': [('validate_only', '=', True)]}"/>
                        </group>
                        <group>
                            <field name="create_missing_vendors" attrs="{'invisible': [('validate_only', '=', True)]}"/>
                            <field name="group_by_vendor" attrs="{'invisible': [('validate_only', '=', True)]}"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page name="instructions" string="Instructions" attrs="{'invisible': [('state', 'not in', ['draft'])]}">
                            <div class="alert alert-info">
                                <h4><i class="fa fa-info-circle"/> Step-by-Step Instructions</h4>
                                <ol class="mb0">
                                    <li><strong>Download Template:</strong> Click "Download Template" button below to get an Excel file pre-populated with your request items</li>
                                    <li><strong>Get Vendor Quotes:</strong> Send the template to vendors or fill in vendor quotations manually</li>
                                    <li><strong>Complete Vendor Info:</strong> Fill in vendor details (name, email, phone, address) for each quote</li>
                                    <li><strong>Set Prices:</strong> Enter the quoted prices from vendors (quantities are already filled from your request)</li>
                                    <li><strong>Upload File:</strong> Upload the completed Excel file using the file picker above</li>
                                    <li><strong>Process:</strong> Click "Upload &amp; Process" to create purchase orders automatically</li>
                                </ol>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="alert alert-success">
                                        <h5><i class="fa fa-download"/> Template Features</h5>
                                        <ul class="mb0">
                                            <li>Pre-populated with your requested items</li>
                                            <li>Product codes and names already filled</li>
                                            <li>Quantities from your request included</li>
                                            <li>Ready to send to vendors</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="alert alert-warning">
                                        <h5><i class="fa fa-exclamation-triangle"/> Required Information</h5>
                                        <strong>You must fill in:</strong>
                                        <ul class="mb0">
                                            <li>Vendor Name (required)</li>
                                            <li>Vendor Email (recommended)</li>
                                            <li>Price Per Quantity (required)</li>
                                            <li>Vendor Phone &amp; Address (optional)</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="alert alert-info">
                                <h5><i class="fa fa-lightbulb-o"/> Pro Tips</h5>
                                <ul class="mb0">
                                    <li><strong>Multiple Vendors:</strong> You can quote the same item from different vendors - separate POs will be created</li>
                                    <li><strong>Vendor Emails:</strong> Include valid email addresses for automatic vendor communication</li>
                                    <li><strong>Consistent Names:</strong> Use consistent vendor names to avoid creating duplicate vendors</li>
                                    <li><strong>Validation:</strong> Use "Validate File" button to check for errors before processing</li>
                                </ul>
                            </div>
                        </page>

                        <page name="validation_results" 
                              string="Validation Results" 
                              attrs="{'invisible': [('validation_result', '=', '')]}">
                            <div class="alert alert-info mb8">
                                <i class="fa fa-info-circle"/> Validation checks your file for errors and missing information.
                            </div>
                            <group>
                                <field name="validation_result" 
                                       widget="text" 
                                       readonly="1"
                                       nolabel="1"
                                       class="o_field_text_validation_result"/>
                            </group>
                        </page>

                        <page name="processing_results" 
                              string="Processing Results" 
                              attrs="{'invisible': [('processing_result', '=', '')]}">
                            <div class="alert alert-success mb8">
                                <i class="fa fa-check-circle"/> Processing complete! Review the results below.
                            </div>
                            <group>
                                <field name="processing_result" 
                                       widget="text" 
                                       readonly="1"
                                       nolabel="1"
                                       class="o_field_text_processing_result"/>
                            </group>
                        </page>
                    </notebook>

                    <field name="state" invisible="1"/>
                </sheet>
                
                <footer>
                    <button name="action_download_template" 
                            string="1. Download Template" 
                            type="object" 
                            class="btn-primary"
                            icon="fa-download"
                            attrs="{'invisible': [('state', 'in', ['processing'])]}"/>
                    
                    <button name="action_validate_file" 
                            string="2. Validate File" 
                            type="object" 
                            class="btn-warning"
                            icon="fa-check-circle"
                            attrs="{'invisible': ['|', ('state', 'in', ['processing', 'done']), ('rfq_excel_file', '=', False)]}"/>
                    
                    <button name="action_upload_rfq" 
                            string="3. Upload &amp; Process" 
                            type="object" 
                            class="btn-success"
                            icon="fa-upload"
                            attrs="{'invisible': [('rfq_excel_file', '=', False)]}"/>
                    
                    <button name="action_reset" 
                            string="Reset" 
                            type="object" 
                            class="btn-secondary"
                            icon="fa-refresh"
                            attrs="{'invisible': [('state', 'in', ['draft', 'processing'])]}"/>
                    
                    <button string="Cancel" 
                            class="btn-secondary" 
                            special="cancel"
                            attrs="{'invisible': [('state', 'in', ['processing'])]}"/>
                    
                    <button string="Close" 
                            class="btn-primary" 
                            special="cancel"
                            attrs="{'invisible': [('state', '!=', 'done')]}"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="action_rfq_upload_wizard" model="ir.actions.act_window">
        <field name="name">RFQ Upload Wizard</field>
        <field name="res_model">rfq.upload.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="view_id" ref="view_rfq_upload_wizard_form"/>
        <field name="context">{'default_memo_id': active_id}</field>
    </record>
</odoo>